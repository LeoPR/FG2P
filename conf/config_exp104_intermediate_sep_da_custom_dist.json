{
  "description": "Exp104 — Intermediate 9.7M + Syllable Separators + Distance-Aware Loss (λ=0.2) + Custom Structural Distances",
  "data": {
    "source": "dicts/pt-br.tsv",
    "train_ratio": 0.6,
    "val_ratio": 0.1,
    "test_ratio": 0.3,
    "split_seed": 42,
    "note": "Mesmos splits de Exp9/102/103 para comparação direta.",
    "grapheme_encoding": "raw",
    "keep_syllable_separators": true
  },
  "model": {
    "embedding_type": "learned",
    "emb_dim": 192,
    "hidden_dim": 384,
    "num_layers": 2,
    "dropout": 0.5,
    "note": "Idêntico Exp103 em arquitetura.",
    "total_params_estimate": "~9.7M"
  },
  "training": {
    "fit_method": "adam",
    "epochs": 120,
    "warmup_epochs": 80,
    "batch_size": 64,
    "lr": 0.001,
    "early_stopping_patience": 10,
    "weight_decay": 1e-05,
    "loss": {
      "type": "distance_aware",
      "config": {
        "distance_lambda": 0.2,
        "distance_metric": "euclidean",
        "normalize_distance": true
      },
      "note": "λ=0.2 ótimo de Exp7. Tokens estruturais '.' e 'ˈ' recebem override d=1.0 para todos os outros tokens via _build_distance_matrix() em losses.py."
    }
  },
  "experiment": {
    "name": "exp104_intermediate_sep_da_custom_dist",
    "purpose": "Corrigir d(.,ˈ)=0.0 com overrides pós-cálculo na distance_matrix. Hipótese: erros '.↔ˈ' caem de ~107 para <30; WER melhora em relação ao Exp103.",
    "hypothesis": "Overrides d(.,ˈ)=1.0 e d(estrutural,fonema)=1.0 fornecem sinal diferenciado suficiente para DA Loss penalizar confusões estruturais. O modelo aprende a distinguir '.' de 'ˈ' via gradiente da distância, não apenas via CE.",
    "compared_with": [
      "exp103: Intermediate 9.7M + sep + DA Loss λ=0.2        (PER 0.53%, WER 5.73%) — mesma config SEM override",
      "exp102: Intermediate 9.7M + sep + CE                   (PER 0.52%, WER 5.79%) — baseline com sep",
      "exp9:   Intermediate 9.7M + DA Loss λ=0.2 (sem sep)   (PER 0.58%, WER 4.96%) — SOTA WER"
    ],
    "quantitative_hypothesis": {
      "structural_errors_exp103": 107,
      "structural_errors_target": "<30",
      "wer_estimate": "< 5.73% (Exp103)",
      "per_estimate": "~0.50-0.53%"
    },
    "expected_metrics": {
      "per_estimate": "~0.50-0.53%",
      "wer_estimate": "~5.1-5.5%",
      "note": "Melhora de WER esperada pela redução de erros estruturais (cada erro '.↔ˈ' = 1 palavra errada no WER)"
    },
    "training_time_estimate": "~6-7h GPU (sequências com separadores, similar ao Exp103)",
    "total_params": "~9.7M",
    "risk": "Override de '.' para todos os tokens pode introduzir gradientes muito fortes para separadores em relação a fonemas — monitore val_loss durante treino.",
    "notes": [
      "Phase 6B: correção da falha identificada em Exp103 (d(.,ˈ)=0.0)",
      "Única diferença em relação ao Exp103: overrides em losses.py e phonetic_features.py",
      "Config criado: 2026-02-24"
    ]
  }
}
